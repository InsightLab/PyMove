
from pandas import DataFrame, Timestamp
from pandas.testing import assert_frame_equal

from pymove import MoveDataFrame, semantic
from pymove.utils.constants import DATETIME, LATITUDE, LONGITUDE, TRAJ_ID

list_data = [
    [39.984094, 116.319236, '2008-10-23 05:53:05', 1],
    [39.984198, 116.319322, '2008-10-23 05:53:06', 1],
    [39.984224, 116.319402, '2008-10-23 05:53:11', 1],
    [39.984211, 116.319389, '2008-10-23 05:53:16', 1],
    [39.984217, 116.319422, '2008-10-23 05:53:21', 1],
    [39.984710, 116.319865, '2008-10-23 05:53:23', 1],
    [39.984674, 116.319810, '2008-10-23 05:53:28', 1],
    [39.984623, 116.319773, '2008-10-23 05:53:33', 1],
    [39.984606, 116.319732, '2008-10-23 05:53:38', 1],
    [39.984555, 116.319728, '2008-10-23 05:53:43', 1]
]

list_data_2 = [
    [39.984094, 116.319236, '2008-10-23 05:53:03', 1],
    [39.984710, 116.319865, '2008-10-23 05:53:13', 1],
    [39.984710, 116.319865, '2008-10-23 05:53:23', 1],
    [39.984710, 116.319865, '2008-10-23 05:53:33', 1],
    [39.984710, 116.319865, '2008-10-23 05:53:43', 1],
    [39.984674, 116.319810, '2008-10-23 05:53:53', 1],
    [39.984710, 116.319865, '2008-10-23 05:54:03', 1],
    [39.984710, 116.319865, '2008-10-23 05:54:13', 1],
    [39.984710, 116.319865, '2008-10-23 05:54:23', 1],
    [39.984555, 116.319728, '2008-10-23 05:54:33', 1]
]


def _default_move_df(data=None):
    if data is None:
        data = list_data
    return MoveDataFrame(
        data=data,
        latitude=LATITUDE,
        longitude=LONGITUDE,
        datetime=DATETIME,
        traj_id=TRAJ_ID,
    )


def test_end_create_operation():
    move_df = _default_move_df()
    expected = DataFrame(
        data=[
            [39.984094, 116.319236, Timestamp('2008-10-23 05:53:05'), 1],
            [39.984198, 116.319322, Timestamp('2008-10-23 05:53:06'), 1],
            [39.984224, 116.319402, Timestamp('2008-10-23 05:53:11'), 1],
            [39.984211, 116.319389, Timestamp('2008-10-23 05:53:16'), 1],
            [39.984217, 116.319422, Timestamp('2008-10-23 05:53:21'), 1],
            [39.984710, 116.319865, Timestamp('2008-10-23 05:53:23'), 1],
            [39.984674, 116.319810, Timestamp('2008-10-23 05:53:28'), 1],
            [39.984623, 116.319773, Timestamp('2008-10-23 05:53:33'), 1],
            [39.984606, 116.319732, Timestamp('2008-10-23 05:53:38'), 1],
            [39.984555, 116.319728, Timestamp('2008-10-23 05:53:43'), 1]
        ],
        columns=['lat', 'lon', 'datetime', 'id'],
        index=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
    )

    new_move_df = semantic._end_create_operation(move_df, 'lat', False)

    assert_frame_equal(new_move_df, expected)

    semantic._end_create_operation(move_df, 'lat', True)

    assert_frame_equal(move_df, expected)
